import{o as t,q as e,d as n,v as r,w as o,l as i,u as s,x as a,y as c,z as u,A as l,B as f,C as p,D as h,b as d}from"./nitro.mjs";import{h as m}from"./index.mjs";import{unified as g}from"unified";import{d as y,g as w,p as k}from"./path-meta.mjs";import{toString as x}from"mdast-util-to-string";import{postprocess as _,preprocess as v}from"micromark";import{stringifyPosition as b}from"unist-util-stringify-position";import{markdownLineEnding as C,markdownSpace as $}from"micromark-util-character";import{push as S,splice as A}from"micromark-util-chunked";import{resolveAll as j}from"micromark-util-resolve-all";import{normalizeUri as P}from"micromark-util-sanitize-uri";import{parseFrontMatter as I}from"remark-mdc";const get=(t,e)=>e.split(".").reduce((t,e)=>t&&t[e],t),_pick=(t,e)=>Object.keys(t).filter(e).reduce((e,n)=>Object.assign(e,{[n]:t[n]}),{}),apply=t=>e=>Array.isArray(e)?e.map(e=>t(e)):t(e),detectProperties=t=>{const e=[],n=[];for(const r of t)["$","_"].includes(r)?e.push(r):n.push(r);return{prefixes:e,properties:n}},withoutKeys=(t=[])=>e=>{if(0===t.length||!e)return e;const{prefixes:n,properties:r}=detectProperties(t);return _pick(e,t=>!r.includes(t)&&!n.includes(t[0]))},withKeys=(t=[])=>e=>{if(0===t.length||!e)return e;const{prefixes:n,properties:r}=detectProperties(t);return _pick(e,t=>r.includes(t)||n.includes(t[0]))},assertArray=(t,e="Expected an array")=>{if(!Array.isArray(t))throw new TypeError(e)},ensureArray=t=>Array.isArray(t)?t:[void 0,null].includes(t)?[]:[t],L=["sort","where","only","without"];function createQuery(t,e={}){const n={};for(const t of Object.keys(e.initialParams||{}))n[t]=L.includes(t)?ensureArray(e.initialParams[t]):e.initialParams[t];const $set=(t,e=t=>t)=>(...o)=>(n[t]=e(...o),r),resolveResult=t=>e.legacy?t?.surround?t.surround:t?(t?.dirConfig&&(t.result={_path:t.dirConfig?._path,...t.result,_dir:t.dirConfig}),t?._path||Array.isArray(t)||!Object.prototype.hasOwnProperty.call(t,"result")?t:t?.result):t:t,r={params:()=>({...n,...n.where?{where:[...ensureArray(n.where)]}:{},...n.sort?{sort:[...ensureArray(n.sort)]}:{}}),only:$set("only",ensureArray),without:$set("without",ensureArray),where:$set("where",t=>[...ensureArray(n.where),...ensureArray(t)]),sort:$set("sort",t=>[...ensureArray(n.sort),...ensureArray(t)]),limit:$set("limit",t=>parseInt(String(t),10)),skip:$set("skip",t=>parseInt(String(t),10)),find:()=>t(r).then(resolveResult),findOne:()=>t($set("first")(!0)).then(resolveResult),count:()=>t($set("count")(!0)).then(resolveResult),locale:t=>r.where({_locale:t}),withSurround:$set("surround",(t,e)=>({query:t,...e})),withDirConfig:()=>$set("dirConfig")(!0)};return e.legacy?(r.findSurround=(t,e)=>r.withSurround(t,e).find().then(resolveResult),r):r}function createTokenizer(t,e,n){let r=Object.assign({line:1,column:1,offset:0},{_index:0,_bufferIndex:-1});const o={},i=[];let s=[],a=[];const c={consume:function(t){C(t)?(r.line++,r.column=1,r.offset+=-3===t?2:1,accountForPotentialSkip()):-1!==t&&(r.column++,r.offset++);r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===s[r._index].length&&(r._bufferIndex=-1,r._index++));u.previous=t},enter:function(t,e){const n=e||{};return n.type=t,n.start=now(),u.events.push(["enter",n,u]),a.push(n),n},exit:function(t){const e=a.pop();return e.end=now(),u.events.push(["exit",e,u]),e},attempt:constructFactory(function(t,e){addResult(t,e.from)}),check:constructFactory(onsuccessfulcheck),interrupt:constructFactory(onsuccessfulcheck,{interrupt:!0})},u={previous:null,code:null,containerState:{},events:[],parser:t,sliceStream:sliceStream,sliceSerialize:function(t,e){return function(t,e){let n=-1;const r=[];let o;for(;++n<t.length;){const i=t[n];let s;if("string"==typeof i)s=i;else switch(i){case-5:s="\r";break;case-4:s="\n";break;case-3:s="\r\n";break;case-2:s=e?" ":"\t";break;case-1:if(!e&&o)continue;s=" ";break;default:s=String.fromCharCode(i)}o=-2===i,r.push(s)}return r.join("")}(sliceStream(t),e)},now:now,defineSkip:function(t){o[t.line]=t.column,accountForPotentialSkip()},write:function(t){if(s=S(s,t),main(),null!==s[s.length-1])return[];return addResult(e,0),u.events=j(i,u.events,u),u.events}};let l=e.tokenize.call(u,c);return e.resolveAll&&i.push(e),u;function sliceStream(t){return function(t,e){const n=e.start._index,r=e.start._bufferIndex,o=e.end._index,i=e.end._bufferIndex;let s;n===o?s=[t[n].slice(r,i)]:(s=t.slice(n,o),r>-1&&(s[0]=s[0].slice(r)),i>0&&s.push(t[o].slice(0,i)));return s}(s,t)}function now(){return Object.assign({},r)}function main(){let t;for(;r._index<s.length;){const e=s[r._index];if("string"==typeof e)for(t=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===t&&r._bufferIndex<e.length;)go(e.charCodeAt(r._bufferIndex));else go(e)}}function go(t){l=l(t)}function onsuccessfulcheck(t,e){e.restore()}function constructFactory(t,e){return function(n,o,i){let s,l,f,p;return Array.isArray(n)?handleListOfConstructs(n):"tokenize"in n?handleListOfConstructs([n]):function(t){return start;function start(e){const n=null!==e&&t[e],r=null!==e&&t.null;return handleListOfConstructs([...Array.isArray(n)?n:n?[n]:[],...Array.isArray(r)?r:r?[r]:[]])(e)}}(n);function handleListOfConstructs(t){return s=t,l=0,0===t.length?i:handleConstruct(t[l])}function handleConstruct(t){return function(n){p=function(){const t=now(),e=u.previous,n=u.currentConstruct,o=u.events.length,i=Array.from(a);return{restore:restore,from:o};function restore(){r=t,u.previous=e,u.currentConstruct=n,u.events.length=o,a=i,accountForPotentialSkip()}}(),f=t,t.partial||(u.currentConstruct=t);if(t.name&&u.parser.constructs.disable.null.includes(t.name))return nok();return t.tokenize.call(e?Object.assign(Object.create(u),e):u,c,ok,nok)(n)}}function ok(e){return t(f,p),o}function nok(t){return p.restore(),++l<s.length?handleConstruct(s[l]):i}}}function addResult(t,e){t.resolveAll&&!i.includes(t)&&i.push(t),t.resolve&&A(u.events,e,u.events.length-e,t.resolve(u.events.slice(e),u)),t.resolveTo&&(u.events=t.resolveTo(u.events,u))}function accountForPotentialSkip(){r.line in o&&r.column<2&&(r.column=o[r.line],r.offset+=o[r.line]-1)}}function initializeDocument(t){const e=this,n=(this.parser.delimiter||",").charCodeAt(0);return enterRow;function enterRow(e){return t.attempt({tokenize:attemptLastLine},e=>(t.consume(e),enterRow),e=>(t.enter("row"),function(e){return t.enter("column"),content(e)}(e)))(e)}function content(r){return null===r?(t.exit("column"),t.exit("row"),t.consume(r),content):34===r?function(e){return t.enter("quotedData"),t.enter("quotedDataChunk"),t.consume(e),quotedDataChunk}(r):r===n?((e.previous===n||C(e.previous)||null===e.previous)&&(t.enter("data"),t.exit("data")),t.exit("column"),t.enter("columnSeparator"),t.consume(r),t.exit("columnSeparator"),t.enter("column"),content):C(r)?(t.exit("column"),t.enter("newline"),t.consume(r),t.exit("newline"),t.exit("row"),enterRow):function(e){return t.enter("data"),dataChunk(e)}(r)}function dataChunk(e){return null===e||C(e)||e===n?(t.exit("data"),content(e)):92===e?escapeCharacter(e):(t.consume(e),dataChunk)}function escapeCharacter(e){return t.consume(e),function(e){return t.consume(e),content}}function quotedDataChunk(e){return 92===e?escapeCharacter(e):34===e?t.attempt({tokenize:attemptDoubleQuote},e=>(t.exit("quotedDataChunk"),t.enter("quotedDataChunk"),quotedDataChunk(e)),e=>(t.consume(e),t.exit("quotedDataChunk"),t.exit("quotedData"),content))(e):(t.consume(e),quotedDataChunk)}}function attemptDoubleQuote(t,e,n){return function(e){if(34!==e)return n(e);return t.enter("quoteFence"),t.consume(e),sequence};function sequence(r){return 34!==r?n(r):(t.consume(r),t.exit("quoteFence"),t=>e(t))}}function attemptLastLine(t,e,n){return function(e){if(!$(e)&&null!==e)return n(e);return t.enter("emptyLine"),continueLine(e)};function continueLine(r){return $(r)?(t.consume(r),continueLine):null===r?(t.exit("emptyLine"),e(r)):n(r)}}const O={}.hasOwnProperty,q={line:1,column:1,offset:0},fromCSV=function(t,e,n){return"string"!=typeof e&&(n=e,e=void 0),function(){const t={enter:{column:opener(openColumn),row:opener(openRow),data:onenterdata,quotedData:onenterdata},exit:{row:closer(),column:closer(),data:onexitdata,quotedData:onexitQuotedData}};return compile;function compile(e){const n={type:"root",children:[]},r=[],o={stack:[n],tokenStack:r,config:t,enter:enter,exit:exit,resume:resume};let i=-1;for(;++i<e.length;){const n=t[e[i][0]];O.call(n,e[i][1].type)&&n[e[i][1].type].call(Object.assign({sliceSerialize:e[i][2].sliceSerialize},o),e[i][1])}if(r.length>0){const t=r[r.length-1];(t[1]||defaultOnError).call(o,void 0,t[0])}return n.position={start:point(e.length>0?e[0][1].start:q),end:point(e.length>0?e[e.length-2][1].end:q)},n}function point(t){return{line:t.line,column:t.column,offset:t.offset}}function opener(t,e){return open;function open(e){enter.call(this,t(e),e)}}function enter(t,e,n){return this.stack[this.stack.length-1].children.push(t),this.stack.push(t),this.tokenStack.push([e,n]),t.position={start:point(e.start)},t}function closer(t){return close;function close(t){exit.call(this,t)}}function exit(t,e){const n=this.stack.pop(),r=this.tokenStack.pop();if(!r)throw new Error("Cannot close `"+t.type+"` ("+b({start:t.start,end:t.end})+"): itâ€™s not open");if(r[0].type!==t.type)if(e)e.call(this,t,r[0]);else{(r[1]||defaultOnError).call(this,t,r[0])}return n.position.end=point(t.end),n}function resume(){return x(this.stack.pop())}function onenterdata(t){const e=this.stack[this.stack.length-1];let n=e.children[e.children.length-1];n&&"text"===n.type||(n=text(),n.position={start:point(t.start)},e.children.push(n)),this.stack.push(n)}function onexitdata(t){const e=this.stack.pop();e.value+=this.sliceSerialize(t).trim().replace(/""/g,'"'),e.position.end=point(t.end)}function onexitQuotedData(t){const e=this.stack.pop(),n=this.sliceSerialize(t);e.value+=this.sliceSerialize(t).trim().substring(1,n.length-1).replace(/""/g,'"'),e.position.end=point(t.end)}function text(){return{type:"text",value:""}}function openColumn(){return{type:"column",children:[]}}function openRow(){return{type:"row",children:[]}}}()(_((t=>createTokenizer({...t},{tokenize:initializeDocument}))(n).write(v()(t,e,!0))))};function defaultOnError(t,e){throw t?new Error("Cannot close `"+t.type+"` ("+b({start:t.start,end:t.end})+"): a different token (`"+e.type+"`, "+b({start:e.start,end:e.end})+") is open"):new Error("Cannot close document, a token (`"+e.type+"`, "+b({start:e.start,end:e.end})+") is still open")}function csvParse(t){Object.assign(this,{Parser:e=>fromCSV(e,t)});Object.assign(this,{Compiler:e=>t.json?(t=>{const[e,...n]=t.children,r=e.children.map(t=>t.children[0].value);return n.map(t=>t.children.reduce((t,e,n)=>(t[String(r[n])]=e.children[0]?.value,t),{}))})(e):e.children.map(t=>t.children.map(t=>t.children[0]?.value))})}const z=y({name:"csv",extensions:[".csv"],parse:async(t,e,n={})=>{const r=g().use(csvParse,{delimiter:",",json:!0,...n}),{result:o}=await r.process(e);return{_id:t,_type:"csv",body:o}}}),E=y({name:"markdown",extensions:[".md"],parse:async(e,n,r={})=>{const o={...r};o.rehypePlugins=await importPlugins(o.rehypePlugins),o.remarkPlugins=await importPlugins(o.remarkPlugins);const i=r.highlight?{...r.highlight,highlighter:"function"==typeof r.highlight?.highlighter?r.highlight.highlighter:void 0}:void 0,s=await t(n,{...o,highlight:i,remark:{plugins:o.remarkPlugins},rehype:{options:{handlers:{link:link}},plugins:o.rehypePlugins},toc:o.toc});return{...s.data,excerpt:s.excerpt,body:{...s.body,toc:s.toc},_type:"markdown",_id:e}}});async function importPlugins(t={}){const e={};for(const[n,r]of Object.entries(t))e[n]=!!r&&{instance:r.instance||await import(n).then(t=>t.default||t),options:r};return e}function link(t,e){const n={...e.attributes||{},href:P(normalizeLink(e.url))};null!==e.title&&void 0!==e.title&&(n.title=e.title);const r={type:"element",tagName:"a",properties:n,children:t.all(e)};return t.patch(e,r),t.applyData(e,r)}function normalizeLink(t){const n=t.match(/#.+$/),r=n?n[0]:"";return t.replace(/#.+$/,"").endsWith(".md")&&(e(t)||!/^https?/.test(t)&&!t.startsWith("/"))?w(t.replace(".md"+r,""),{forceLeadingSlash:!1})+r:t}const D=y({name:"Yaml",extensions:[".yml",".yaml"],parse:(t,e)=>{const{data:n}=I(`---\n${e}\n---`);let r=n;return Array.isArray(n)&&(console.warn(`YAML array is not supported in ${t}, moving the array into the \`body\` key`),r={body:n}),{...r,_id:t,_type:"yaml"}}}),R=[z,E,y({name:"Json",extensions:[".json",".json5"],parse:async(t,e)=>{let r;return"string"==typeof e?t.endsWith("json5")?r=(await import("json5").then(t=>t.default||t)).parse(e):t.endsWith("json")&&(r=n(e)):r=e,Array.isArray(r)&&(console.warn(`JSON array is not supported in ${t}, moving the array into the \`body\` key`),r={body:r}),{...r,_id:t,_type:"json"}}}),D,k];async function transformContent(t,e,n={}){const{transformers:i=[]}=n,s={_id:t,body:e},a=r(t),c=function(t,e=[]){let n=e.find(e=>t.match(new RegExp(e.extensions.join("|"),"i"))&&e.parse);return n||(n=R.find(e=>t.match(new RegExp(e.extensions.join("|"),"i"))&&e.parse)),n}(a,i);if(!c)return console.warn(`${a} files are not supported, "${t}" falling back to raw content`),s;const u=n[o(c.name)]||{},l=await c.parse(s._id,s.body,u),f=function(t,e=[]){return[...e.filter(e=>t.match(new RegExp(e.extensions.join("|"),"i"))&&e.transform),...R.filter(e=>t.match(new RegExp(e.extensions.join("|"),"i"))&&e.transform)]}(a,i);return await f.reduce(async(t,e)=>{const r=await t||l,i=n[o(e.name)];return!1===i?r:e.transform(r,i||{})},Promise.resolve(l))}function createMatch(t={}){const e=function(t,e={}){return{$match:(e,n)=>t(e,n),$eq:(t,e)=>e instanceof RegExp?e.test(t):t===e,$ne:(t,e)=>e instanceof RegExp?!e.test(t):t!==e,$not:(e,n)=>!t(e,n),$and:(e,n)=>(assertArray(n,"$and requires an array as condition"),n.every(n=>t(e,n))),$or:(e,n)=>(assertArray(n,"$or requires an array as condition"),n.some(n=>t(e,n))),$in:(e,n)=>ensureArray(n).some(n=>Array.isArray(e)?t(e,{$contains:n}):t(e,n)),$contains:(t,e)=>(t=Array.isArray(t)?t:String(t),ensureArray(e).every(e=>t.includes(e))),$icontains:(t,e)=>{if("string"!=typeof e)throw new TypeError("$icontains requires a string, use $contains instead");return t=String(t).toLocaleLowerCase(),ensureArray(e).every(e=>t.includes(e.toLocaleLowerCase()))},$containsAny:(t,e)=>(assertArray(e,"$containsAny requires an array as condition"),t=Array.isArray(t)?t:String(t),e.some(e=>t.includes(e))),$exists:(t,e)=>e?void 0!==t:void 0===t,$type:(t,e)=>typeof t===String(e),$regex:(t,e)=>{if(!(e instanceof RegExp)){const t=String(e).match(/\/(.*)\/([dgimsuy]*)$/);e=t?.[1]?new RegExp(t[1],t[2]||""):new RegExp(e)}return e.test(String(t||""))},$lt:(t,e)=>t<e,$lte:(t,e)=>t<=e,$gt:(t,e)=>t>e,$gte:(t,e)=>t>=e,...e||{}}}(match,t.operators);function match(t,n){return"object"!=typeof n||n instanceof RegExp?e.$eq(t,n):Object.keys(n||{}).every(r=>{const o=n[r];if(r.startsWith("$")&&e[r]){const n=e[r];return"function"==typeof n&&n(t,o)}return match(get(t,r),o)})}return match}function createPipelineFetcher(t){const e=createMatch(),n=[(t,n)=>{const r=t.result.filter(t=>ensureArray(n.where).every(n=>e(t,n)));return{...t,result:r,total:r.length}},(t,e)=>ensureArray(e.sort).forEach(e=>((t,e)=>{const n=new Intl.Collator(e.$locale,{numeric:e.$numeric,caseFirst:e.$caseFirst,sensitivity:e.$sensitivity}),r=Object.keys(e).filter(t=>!t.startsWith("$"));for(const o of r)t=t.sort((t,r)=>{const i=[get(t,o),get(r,o)].map(t=>{if(null!==t)return t instanceof Date?t.toISOString():t});return-1===e[o]&&i.reverse(),n.compare(i[0],i[1])});return t})(t.result,e)),function(t,n,r){if(n.surround){let o=((t,{query:n,before:r,after:o})=>{const i="string"==typeof n?{_path:n}:n,s=t.findIndex(t=>e(t,i));r=r??1,o=o??1;const a=new Array(r+o).fill(null,0);return-1===s?a:a.map((e,n)=>t[s-r+n+Number(n>=r)]||null)})(1===t.result?.length?r:t.result,n.surround);o=apply(withoutKeys(n.without))(o),o=apply(withKeys(n.only))(o),t.surround=o}return t}],r=[(t,e)=>{if(e.skip)return{...t,result:t.result.slice(e.skip),skip:e.skip}},(t,e)=>{if(e.limit)return{...t,result:t.result.slice(0,e.limit),limit:e.limit}},function(t,e,n){if(e.dirConfig){const r=t.result[0]?._path||e.where?.find(t=>t._path)?._path;if("string"==typeof r){const e=n.find(t=>t._path===i(r,"_dir"));e&&(t.dirConfig={_path:e._path,...withoutKeys(["_"])(e)})}}return t},(t,e)=>({...t,result:apply(withoutKeys(e.without))(t.result)}),(t,e)=>({...t,result:apply(withKeys(e.only))(t.result)})];return async e=>{const o=await t(),i=e.params(),s={result:o,limit:0,skip:0,total:o.length},a=n.reduce((t,e)=>e(t,i,o)||t,s);if(i.count)return{result:a.result.length};const c=r.reduce((t,e)=>e(t,i,o)||t,a);return i.first?{...(u=["skip","limit","total"],t=>u&&u.length?_pick(t,t=>!u.includes(t)):t)(c),result:c.result[0]}:c;var u}}async function getContentIndex(t){const e=s().content.defaultLocale;let n=await cacheStorage().getItem("content-index.json");if(!n){n=(await N(t)).reduce((t,n)=>(t[n._path]=t[n._path]||[],n._locale===e?t[n._path].unshift(n._id):t[n._path].push(n._id),t),{}),await cacheStorage().setItem("content-index.json",n)}return n}async function getIndexedContentsList(t,e){const n=e.params(),r=n?.where?.find(t=>t._path)?._path;if(!a(t)&&!n.surround&&!n.dirConfig&&("string"==typeof r||r instanceof RegExp)){const e=await getContentIndex(t),n=[...chunksFromArray(Object.keys(e).filter(t=>r.test?r.test(t):t===String(r)).flatMap(t=>e[t]),10)],o=[];for await(const e of n){const n=await Promise.all(e.map(e=>getContent(t,e)));o.push(...n)}return o}return N(t)}const F=Object.freeze(Object.defineProperty({__proto__:null,getContentIndex:getContentIndex,getIndexedContentsList:getIndexedContentsList},Symbol.toStringTag,{value:"Module"})),M=[];let Q,T,W;const sourceStorage=()=>(Q||(Q=l(f(),"content:source")),Q),cacheStorage=()=>(T||(T=l(f(),"cache:content")),T),cacheParsedStorage=()=>(W||(W=l(f(),"cache:content:parsed")),W),contentConfig=()=>s().content,K="'\"?#/".split(""),contentIgnorePredicate=t=>{const e=function(t){const e=["/\\.","/-",...t.filter(t=>t)].map(t=>new RegExp(t));return function(t){const n="/"+t.replace(/:/g,"/");return e.some(t=>t.test(n))}}(contentConfig().ignores);return!t.startsWith("preview:")&&!e(t)&&(!K.some(e=>t.includes(e))||(console.warn(`Ignoring [${t}]. File name should not contain any of the following characters: ${K.join(", ")}`),!1))},getContentsIds=async(t,e)=>{let n=[];n=await cacheParsedStorage().getKeys(e);const r=sourceStorage();if(0===n.length&&(n=await r.getKeys(e)),a(t)){const{key:o}=p(t),i=`preview:${o}:${e||""}`,s=await r.getKeys(i);if(s.length){const t=new Set(n);await Promise.all(s.map(async e=>{const n=await r.getMeta(e);n?.__deleted?t.delete(e.substring(i.length)):t.add(e.substring(i.length))})),n=Array.from(t)}}return n.filter(contentIgnorePredicate)};function*chunksFromArray(t,e){for(let n=0;n<t.length;n+=e)yield t.slice(n,n+e)}const N=(()=>{let t=null;return(e,n)=>e.context.__contentList?e.context.__contentList:(t||(t=(async(t,e)=>{const n=[...chunksFromArray(await getContentsIds(t,e),10)],r=[];for(const e of n){const n=await Promise.all(e.map(e=>getContent(t,e)));r.push(...n)}return r.filter(t=>t&&t._path)})(e,n),t.then(n=>{e.context.__contentList=n,t=null})),t)})(),H={},getContent=async(t,e)=>{const n=e;if(!contentIgnorePredicate(e))return{_id:n,body:null};const r=sourceStorage(),o=cacheParsedStorage();if(a(t)){const{key:n}=p(t),o=`preview:${n}:${e}`;await r.getItem(o)&&(e=o)}const i=await o.getItem(e);if(i)return i.parsed;const s=contentConfig(),c=await r.getMeta(e),u=c.mtime,l=c.size||0,f=m({mtime:u,size:l,version:s.cacheVersion,integrity:s.cacheIntegrity});return i?.hash===f?i.parsed:(H[e+f]||(H[e+f]=new Promise(async t=>{const i=await r.getItem(e);if(null===i)return t({_id:n,body:null});const s=await parseContent(n,i);await o.setItem(e,{parsed:s,hash:f}).catch(()=>{}),t(s),delete H[e+f]})),H[e+f])},parseContent=async(t,e,n={})=>{const r=d(),o=contentConfig(),i=h(n,{markdown:{...o.markdown,highlight:o.highlight},csv:o.csv,yaml:o.yaml,transformers:M,pathMeta:{defaultLocale:o.defaultLocale,locales:o.locales,respectPathCase:o.respectPathCase}}),s={_id:t,body:"string"==typeof e?e.replace(/\r\n|\r/g,"\n"):e};await r.hooks.callHook("content:file:beforeParse",s);const a=await transformContent(t,s.body,i);return await r.hooks.callHook("content:file:afterParse",a),a},createServerQueryFetch=t=>e=>createPipelineFetcher(()=>getIndexedContentsList(t,e))(e);const J=Object.freeze(Object.defineProperty({__proto__:null,cacheParsedStorage:cacheParsedStorage,cacheStorage:cacheStorage,chunksFromArray:chunksFromArray,createServerQueryFetch:createServerQueryFetch,getContent:getContent,getContentsIds:getContentsIds,getContentsList:N,parseContent:parseContent,serverQueryContent:function(t,e,...n){const{advanceQuery:r}=s().public.content.experimental,o=contentConfig(),a=createQuery(createServerQueryFetch(t),r?{initialParams:"string"!=typeof e&&e||{},legacy:!1}:{initialParams:"string"!=typeof e&&e||{},legacy:!0});let l;"string"==typeof e&&(l=c(i(e,...n)));const f=a.params;return a.params=()=>{const t=f();if(l&&(t.where=t.where||[],t.first&&0===(t.where||[]).length?t.where.push({_path:u(l)}):t.where.push({_path:new RegExp(`^${l.replace(/[-[\]{}()*+.,^$\s/]/g,"\\$&")}`)})),t.sort?.length||(t.sort=[{_stem:1,$numeric:!0}]),t.where=t.where||[],t.where.find(t=>void 0!==t._draft)||t.where.push({_draft:{$ne:!0}}),o.locales.length){const e=t.where?.find(t=>t._locale)?._locale;e||(t.where=t.where||[],t.where.push({_locale:o.defaultLocale}))}return t},a},sourceStorage:sourceStorage},Symbol.toStringTag,{value:"Module"}));export{F as c,J as s};
//# sourceMappingURL=storage.mjs.map
