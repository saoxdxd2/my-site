import{i as r,e}from"./nitro.mjs";import"unified";import"remark-parse";import"remark-rehype";import"remark-mdc";import"remark-gfm";import"rehype-external-links";import"rehype-sort-attribute-values";import"rehype-sort-attributes";import"rehype-raw";import"detab";import"micromark-util-sanitize-uri";import"hast-util-to-string";import"github-slugger";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:url";import"node:path";import"node:crypto";function regExpReviver(r,e){const t="string"==typeof e&&e.match(/^--([A-Z]+) (.+)$/)||[];if("REGEX"===t[1]){const r=t[2]?.match(/\/(.*)\/([dgimsuy]*)$/);return r?.[1]?new RegExp(r[1],r[2]||""):e}return e}const parseJSONQueryParams=r=>{try{return t=r,JSON.parse(t,regExpReviver)}catch{throw e({statusCode:400,message:"Invalid _params query"})}var t},decodeQueryParams=r=>(r=(r=(r=r.replace(/\//g,"")).replace(/-/g,"+").replace(/_/g,"/")).padEnd(r.length+(4-r.length%4)%4,"="),parseJSONQueryParams("undefined"!=typeof Buffer?Buffer.from(r,"base64").toString():atob(r))),t={},getContentQuery=e=>{const{params:o}=e.context.params||{};if(o)return decodeQueryParams(o.replace(/.json$/,""));const i=e.context.params?.qid?.replace(/.json$/,""),p=r(e)||{};if(i&&p._params)return t[i]=parseJSONQueryParams(decodeURIComponent(p._params)),t[i]?.where&&!Array.isArray(t[i]?.where)&&(t[i].where=[t[i].where]),t[i];if(i&&t[i])return t[i];if(p._params)return parseJSONQueryParams(decodeURIComponent(p._params));"string"==typeof p.only&&p.only.includes(",")&&(p.only=p.only.split(",").map(r=>r.trim())),"string"==typeof p.without&&p.without.includes(",")&&(p.without=p.without.split(",").map(r=>r.trim()));const n=p.where||{};for(const r of["draft","partial","empty"])p[r]&&["true","false"].includes(p[r])&&(n[r]="true"===p[r],delete p[r]);p.sort&&(p.sort=String(p.sort).split(",").map(r=>{const[e,t]=r.split(":");return[e,Number.parseInt(t||"0",10)]}));const s=["partial","draft","only","without","where","sort","limit","skip"];for(const r of Object.keys(p))s.includes(r)||(p.where=p.where||{},p.where[r]=p[r]);return Object.keys(n).length>0?p.where=[n]:delete p.where,p};export{decodeQueryParams,getContentQuery};
//# sourceMappingURL=query.mjs.map
