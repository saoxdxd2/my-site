import{ref as e}from"vue";import{R as t,d as r,S as n,T as i,U as s,V as a}from"../_/nitro.mjs";import{c,g as u,e as f}from"./server.mjs";function decode(e){return e.includes("%")?decodeURIComponent(e):e}function tryDecode(e,t){try{return t(e)}catch{return e}}function serialize(e){return"string"==typeof e?`'${e}'`:(new p).serialize(e)}const p=function(){class o{#e=new Map;compare(e,t){const r=typeof e,n=typeof t;return"string"===r&&"string"===n?e.localeCompare(t):"number"===r&&"number"===n?e-t:String.prototype.localeCompare.call(this.serialize(e,!0),this.serialize(t,!0))}serialize(e,t){if(null===e)return"null";switch(typeof e){case"string":return t?e:`'${e}'`;case"bigint":return`${e}n`;case"object":return this.$object(e);case"function":return this.$function(e)}return String(e)}serializeObject(e){const t=Object.prototype.toString.call(e);if("[object Object]"!==t)return this.serializeBuiltInType(t.length<10?`unknown:${t}`:t.slice(8,-1),e);const r=e.constructor,n=r===Object||void 0===r?"":r.name;if(""!==n&&globalThis[n]===r)return this.serializeBuiltInType(n,e);if("function"==typeof e.toJSON){const t=e.toJSON();return n+(null!==t&&"object"==typeof t?this.$object(t):`(${this.serialize(t)})`)}return this.serializeObjectEntries(n,Object.entries(e))}serializeBuiltInType(e,t){const r=this["$"+e];if(r)return r.call(this,t);if("function"==typeof t?.entries)return this.serializeObjectEntries(e,t.entries());throw new Error(`Cannot serialize ${e}`)}serializeObjectEntries(e,t){const r=Array.from(t).sort((e,t)=>this.compare(e[0],t[0]));let n=`${e}{`;for(let e=0;e<r.length;e++){const[t,i]=r[e];n+=`${this.serialize(t,!0)}:${this.serialize(i)}`,e<r.length-1&&(n+=",")}return n+"}"}$object(e){let t=this.#e.get(e);return void 0===t&&(this.#e.set(e,`#${this.#e.size}`),t=this.serializeObject(e),this.#e.set(e,t)),t}$function(e){const t=Function.prototype.toString.call(e);return"[native code] }"===t.slice(-15)?`${e.name||""}()[native]`:`${e.name}(${e.length})${t.replace(/\s*\n\s*/g,"")}`}$Array(e){let t="[";for(let r=0;r<e.length;r++)t+=this.serialize(e[r]),r<e.length-1&&(t+=",");return t+"]"}$Date(e){try{return`Date(${e.toISOString()})`}catch{return"Date(null)"}}$ArrayBuffer(e){return`ArrayBuffer[${new Uint8Array(e).join(",")}]`}$Set(e){return`Set${this.$Array(Array.from(e).sort((e,t)=>this.compare(e,t)))}`}$Map(e){return this.serializeObjectEntries("Map",e.entries())}}for(const e of["Error","RegExp","URL"])o.prototype["$"+e]=function(t){return`${e}(${t})`};for(const e of["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"])o.prototype["$"+e]=function(t){return`${e}[${t.join(",")}]`};for(const e of["BigInt64Array","BigUint64Array"])o.prototype["$"+e]=function(t){return`${e}[${t.join("n,")}${t.length>0?"n":""}]`};return o}();function isEqual(e,t){return e===t||serialize(e)===serialize(t)}const y={path:"/",watch:!0,decode:e=>r(decodeURIComponent(e)),encode:e=>encodeURIComponent("string"==typeof e?e:JSON.stringify(e))};function l(r,c){var p,h;const $={...y,...c};null!=$.filter||($.filter=e=>e===r);const d=function(e={}){return function(e,t){if("string"!=typeof e)throw new TypeError("argument str must be a string");const r={},n=t||{},i=n.decode||decode;let s=0;for(;s<e.length;){const t=e.indexOf("=",s);if(-1===t)break;let a=e.indexOf(";",s);if(-1===a)a=e.length;else if(a<t){s=e.lastIndexOf(";",t-1)+1;continue}const c=e.slice(s,t).trim();if(!n?.filter||n?.filter(c)){if(void 0===r[c]){let n=e.slice(t+1,a).trim();34===n.codePointAt(0)&&(n=n.slice(1,-1)),r[c]=tryDecode(n,i)}s=a+1}else s=a+1}return r}(t(u(),"cookie")||"",e)}($)||{};let g;void 0!==$.maxAge?g=1e3*$.maxAge:$.expires&&(g=$.expires.getTime()-Date.now());const m=n(void 0!==g&&g<=0?void 0:null!=(h=d[r])?h:null==(p=$.default)?void 0:p.call($)),b=e(m);{const e=f(),o2=()=>{$.readonly||isEqual(b.value,d[r])||(e._cookies||(e._cookies={}),r in e._cookies&&isEqual(b.value,e._cookies[r])||(e._cookies[r]=b.value,function(e,t,r,n={}){if(e){if(null!=r)return i(e,t,r,n);void 0!==s(e,t)&&a(e,t,n)}}(u(e),r,b.value,$)))},t=e.hooks.hookOnce("app:rendered",o2);e.hooks.hookOnce("app:error",()=>(t(),o2()))}return b}const v=()=>({isEnabled:()=>{const e=c().query;return!(Object.prototype.hasOwnProperty.call(e,"preview")&&!e.preview||!e.preview&&!l("previewToken").value)},getPreviewToken:()=>l("previewToken").value||void 0,setPreviewToken:e=>{l("previewToken").value=e,c().query.preview=e||""}});export{v};
//# sourceMappingURL=preview-C8Om5VAN.mjs.map
