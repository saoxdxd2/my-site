import{prefixStorage as e}from"file://C:/Users/sao/Documents/my-site/node_modules/unstorage/dist/index.mjs";import{isRelative as t,joinURL as n,withLeadingSlash as r,withoutTrailingSlash as o}from"file://C:/Users/sao/Documents/my-site/node_modules/ufo/dist/index.mjs";import{hash as s}from"file://C:/Users/sao/Documents/my-site/node_modules/ohash/dist/index.mjs";import i from"file://C:/Users/sao/Documents/my-site/node_modules/defu/dist/defu.mjs";import{extname as a}from"file://C:/Users/sao/Documents/my-site/node_modules/pathe/dist/index.mjs";import{camelCase as c}from"file://C:/Users/sao/Documents/my-site/node_modules/scule/dist/index.mjs";import{unified as u}from"file://C:/Users/sao/Documents/my-site/node_modules/unified/index.js";import{d as l,g as d,p as f}from"./path-meta.mjs";import{toString as m}from"file://C:/Users/sao/Documents/my-site/node_modules/mdast-util-to-string/index.js";import{postprocess as p,preprocess as h}from"file://C:/Users/sao/Documents/my-site/node_modules/micromark/index.js";import{stringifyPosition as y}from"file://C:/Users/sao/Documents/my-site/node_modules/unist-util-stringify-position/index.js";import{markdownLineEnding as g,markdownSpace as w}from"file://C:/Users/sao/Documents/my-site/node_modules/micromark-util-character/index.js";import{push as x,splice as k}from"file://C:/Users/sao/Documents/my-site/node_modules/micromark-util-chunked/index.js";import{resolveAll as _}from"file://C:/Users/sao/Documents/my-site/node_modules/micromark-util-resolve-all/index.js";import{normalizeUri as C}from"file://C:/Users/sao/Documents/my-site/node_modules/micromark-util-sanitize-uri/index.js";import{c as v,a as b,i as j,e as $,f as S,u as A}from"./nitro.mjs";import{parseFrontMatter as D}from"file://C:/Users/sao/Documents/my-site/node_modules/remark-mdc/dist/index.mjs";import{destr as P}from"file://C:/Users/sao/Documents/my-site/node_modules/destr/dist/index.mjs";const get=(e,t)=>t.split(".").reduce((e,t)=>e&&e[t],e),_pick=(e,t)=>Object.keys(e).filter(t).reduce((t,n)=>Object.assign(t,{[n]:e[n]}),{}),apply=e=>t=>Array.isArray(t)?t.map(t=>e(t)):e(t),detectProperties=e=>{const t=[],n=[];for(const r of e)["$","_"].includes(r)?t.push(r):n.push(r);return{prefixes:t,properties:n}},withoutKeys=(e=[])=>t=>{if(0===e.length||!t)return t;const{prefixes:n,properties:r}=detectProperties(e);return _pick(t,e=>!r.includes(e)&&!n.includes(e[0]))},withKeys=(e=[])=>t=>{if(0===e.length||!t)return t;const{prefixes:n,properties:r}=detectProperties(e);return _pick(t,e=>r.includes(e)||n.includes(e[0]))},assertArray=(e,t="Expected an array")=>{if(!Array.isArray(e))throw new TypeError(t)},ensureArray=e=>Array.isArray(e)?e:[void 0,null].includes(e)?[]:[e],I=["sort","where","only","without"];function createQuery(e,t={}){const n={};for(const e of Object.keys(t.initialParams||{}))n[e]=I.includes(e)?ensureArray(t.initialParams[e]):t.initialParams[e];const $set=(e,t=e=>e)=>(...o)=>(n[e]=t(...o),r),resolveResult=e=>t.legacy?e?.surround?e.surround:e?(e?.dirConfig&&(e.result={_path:e.dirConfig?._path,...e.result,_dir:e.dirConfig}),e?._path||Array.isArray(e)||!Object.prototype.hasOwnProperty.call(e,"result")?e:e?.result):e:e,r={params:()=>({...n,...n.where?{where:[...ensureArray(n.where)]}:{},...n.sort?{sort:[...ensureArray(n.sort)]}:{}}),only:$set("only",ensureArray),without:$set("without",ensureArray),where:$set("where",e=>[...ensureArray(n.where),...ensureArray(e)]),sort:$set("sort",e=>[...ensureArray(n.sort),...ensureArray(e)]),limit:$set("limit",e=>parseInt(String(e),10)),skip:$set("skip",e=>parseInt(String(e),10)),find:()=>e(r).then(resolveResult),findOne:()=>e($set("first")(!0)).then(resolveResult),count:()=>e($set("count")(!0)).then(resolveResult),locale:e=>r.where({_locale:e}),withSurround:$set("surround",(e,t)=>({query:e,...t})),withDirConfig:()=>$set("dirConfig")(!0)};return t.legacy?(r.findSurround=(e,t)=>r.withSurround(e,t).find().then(resolveResult),r):r}function createTokenizer(e,t,n){let r=Object.assign({line:1,column:1,offset:0},{_index:0,_bufferIndex:-1});const o={},s=[];let i=[],a=[];const c={consume:function(e){g(e)?(r.line++,r.column=1,r.offset+=-3===e?2:1,accountForPotentialSkip()):-1!==e&&(r.column++,r.offset++);r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===i[r._index].length&&(r._bufferIndex=-1,r._index++));u.previous=e},enter:function(e,t){const n=t||{};return n.type=e,n.start=now(),u.events.push(["enter",n,u]),a.push(n),n},exit:function(e){const t=a.pop();return t.end=now(),u.events.push(["exit",t,u]),t},attempt:constructFactory(function(e,t){addResult(e,t.from)}),check:constructFactory(onsuccessfulcheck),interrupt:constructFactory(onsuccessfulcheck,{interrupt:!0})},u={previous:null,code:null,containerState:{},events:[],parser:e,sliceStream:sliceStream,sliceSerialize:function(e,t){return function(e,t){let n=-1;const r=[];let o;for(;++n<e.length;){const s=e[n];let i;if("string"==typeof s)i=s;else switch(s){case-5:i="\r";break;case-4:i="\n";break;case-3:i="\r\n";break;case-2:i=t?" ":"\t";break;case-1:if(!t&&o)continue;i=" ";break;default:i=String.fromCharCode(s)}o=-2===s,r.push(i)}return r.join("")}(sliceStream(e),t)},now:now,defineSkip:function(e){o[e.line]=e.column,accountForPotentialSkip()},write:function(e){if(i=x(i,e),main(),null!==i[i.length-1])return[];return addResult(t,0),u.events=_(s,u.events,u),u.events}};let l=t.tokenize.call(u,c);return t.resolveAll&&s.push(t),u;function sliceStream(e){return function(e,t){const n=t.start._index,r=t.start._bufferIndex,o=t.end._index,s=t.end._bufferIndex;let i;n===o?i=[e[n].slice(r,s)]:(i=e.slice(n,o),r>-1&&(i[0]=i[0].slice(r)),s>0&&i.push(e[o].slice(0,s)));return i}(i,e)}function now(){return Object.assign({},r)}function main(){let e;for(;r._index<i.length;){const t=i[r._index];if("string"==typeof t)for(e=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===e&&r._bufferIndex<t.length;)go(t.charCodeAt(r._bufferIndex));else go(t)}}function go(e){l=l(e)}function onsuccessfulcheck(e,t){t.restore()}function constructFactory(e,t){return function(n,o,s){let i,l,d,f;return Array.isArray(n)?handleListOfConstructs(n):"tokenize"in n?handleListOfConstructs([n]):function(e){return start;function start(t){const n=null!==t&&e[t],r=null!==t&&e.null;return handleListOfConstructs([...Array.isArray(n)?n:n?[n]:[],...Array.isArray(r)?r:r?[r]:[]])(t)}}(n);function handleListOfConstructs(e){return i=e,l=0,0===e.length?s:handleConstruct(e[l])}function handleConstruct(e){return function(n){f=function(){const e=now(),t=u.previous,n=u.currentConstruct,o=u.events.length,s=Array.from(a);return{restore:restore,from:o};function restore(){r=e,u.previous=t,u.currentConstruct=n,u.events.length=o,a=s,accountForPotentialSkip()}}(),d=e,e.partial||(u.currentConstruct=e);if(e.name&&u.parser.constructs.disable.null.includes(e.name))return nok();return e.tokenize.call(t?Object.assign(Object.create(u),t):u,c,ok,nok)(n)}}function ok(t){return e(d,f),o}function nok(e){return f.restore(),++l<i.length?handleConstruct(i[l]):s}}}function addResult(e,t){e.resolveAll&&!s.includes(e)&&s.push(e),e.resolve&&k(u.events,t,u.events.length-t,e.resolve(u.events.slice(t),u)),e.resolveTo&&(u.events=e.resolveTo(u.events,u))}function accountForPotentialSkip(){r.line in o&&r.column<2&&(r.column=o[r.line],r.offset+=o[r.line]-1)}}function initializeDocument(e){const t=this,n=(this.parser.delimiter||",").charCodeAt(0);return enterRow;function enterRow(t){return e.attempt({tokenize:attemptLastLine},t=>(e.consume(t),enterRow),t=>(e.enter("row"),function(t){return e.enter("column"),content(t)}(t)))(t)}function content(r){return null===r?(e.exit("column"),e.exit("row"),e.consume(r),content):34===r?function(t){return e.enter("quotedData"),e.enter("quotedDataChunk"),e.consume(t),quotedDataChunk}(r):r===n?((t.previous===n||g(t.previous)||null===t.previous)&&(e.enter("data"),e.exit("data")),e.exit("column"),e.enter("columnSeparator"),e.consume(r),e.exit("columnSeparator"),e.enter("column"),content):g(r)?(e.exit("column"),e.enter("newline"),e.consume(r),e.exit("newline"),e.exit("row"),enterRow):function(t){return e.enter("data"),dataChunk(t)}(r)}function dataChunk(t){return null===t||g(t)||t===n?(e.exit("data"),content(t)):92===t?escapeCharacter(t):(e.consume(t),dataChunk)}function escapeCharacter(t){return e.consume(t),function(t){return e.consume(t),content}}function quotedDataChunk(t){return 92===t?escapeCharacter(t):34===t?e.attempt({tokenize:attemptDoubleQuote},t=>(e.exit("quotedDataChunk"),e.enter("quotedDataChunk"),quotedDataChunk(t)),t=>(e.consume(t),e.exit("quotedDataChunk"),e.exit("quotedData"),content))(t):(e.consume(t),quotedDataChunk)}}function attemptDoubleQuote(e,t,n){return function(t){if(34!==t)return n(t);return e.enter("quoteFence"),e.consume(t),sequence};function sequence(r){return 34!==r?n(r):(e.consume(r),e.exit("quoteFence"),e=>t(e))}}function attemptLastLine(e,t,n){return function(t){if(!w(t)&&null!==t)return n(t);return e.enter("emptyLine"),continueLine(t)};function continueLine(r){return w(r)?(e.consume(r),continueLine):null===r?(e.exit("emptyLine"),t(r)):n(r)}}const L={}.hasOwnProperty,O={line:1,column:1,offset:0},fromCSV=function(e,t,n){return"string"!=typeof t&&(n=t,t=void 0),function(){const e={enter:{column:opener(openColumn),row:opener(openRow),data:onenterdata,quotedData:onenterdata},exit:{row:closer(),column:closer(),data:onexitdata,quotedData:onexitQuotedData}};return compile;function compile(t){const n={type:"root",children:[]},r=[],o={stack:[n],tokenStack:r,config:e,enter:enter,exit:exit,resume:resume};let s=-1;for(;++s<t.length;){const n=e[t[s][0]];L.call(n,t[s][1].type)&&n[t[s][1].type].call(Object.assign({sliceSerialize:t[s][2].sliceSerialize},o),t[s][1])}if(r.length>0){const e=r[r.length-1];(e[1]||defaultOnError).call(o,void 0,e[0])}return n.position={start:point(t.length>0?t[0][1].start:O),end:point(t.length>0?t[t.length-2][1].end:O)},n}function point(e){return{line:e.line,column:e.column,offset:e.offset}}function opener(e,t){return open;function open(t){enter.call(this,e(t),t)}}function enter(e,t,n){return this.stack[this.stack.length-1].children.push(e),this.stack.push(e),this.tokenStack.push([t,n]),e.position={start:point(t.start)},e}function closer(e){return close;function close(e){exit.call(this,e)}}function exit(e,t){const n=this.stack.pop(),r=this.tokenStack.pop();if(!r)throw new Error("Cannot close `"+e.type+"` ("+y({start:e.start,end:e.end})+"): it’s not open");if(r[0].type!==e.type)if(t)t.call(this,e,r[0]);else{(r[1]||defaultOnError).call(this,e,r[0])}return n.position.end=point(e.end),n}function resume(){return m(this.stack.pop())}function onenterdata(e){const t=this.stack[this.stack.length-1];let n=t.children[t.children.length-1];n&&"text"===n.type||(n=text(),n.position={start:point(e.start)},t.children.push(n)),this.stack.push(n)}function onexitdata(e){const t=this.stack.pop();t.value+=this.sliceSerialize(e).trim().replace(/""/g,'"'),t.position.end=point(e.end)}function onexitQuotedData(e){const t=this.stack.pop(),n=this.sliceSerialize(e);t.value+=this.sliceSerialize(e).trim().substring(1,n.length-1).replace(/""/g,'"'),t.position.end=point(e.end)}function text(){return{type:"text",value:""}}function openColumn(){return{type:"column",children:[]}}function openRow(){return{type:"row",children:[]}}}()(p((e=>createTokenizer({...e},{tokenize:initializeDocument}))(n).write(h()(e,t,!0))))};function defaultOnError(e,t){throw e?new Error("Cannot close `"+e.type+"` ("+y({start:e.start,end:e.end})+"): a different token (`"+t.type+"`, "+y({start:t.start,end:t.end})+") is open"):new Error("Cannot close document, a token (`"+t.type+"`, "+y({start:t.start,end:t.end})+") is still open")}function csvParse(e){Object.assign(this,{Parser:t=>fromCSV(t,e)});Object.assign(this,{Compiler:t=>e.json?(e=>{const[t,...n]=e.children,r=t.children.map(e=>e.children[0].value);return n.map(e=>e.children.reduce((e,t,n)=>(e[String(r[n])]=t.children[0]?.value,e),{}))})(t):t.children.map(e=>e.children.map(e=>e.children[0]?.value))})}const q=l({name:"csv",extensions:[".csv"],parse:async(e,t,n={})=>{const r=u().use(csvParse,{delimiter:",",json:!0,...n}),{result:o}=await r.process(t);return{_id:e,_type:"csv",body:o}}}),z=l({name:"markdown",extensions:[".md"],parse:async(e,t,n={})=>{const r={...n};r.rehypePlugins=await importPlugins(r.rehypePlugins),r.remarkPlugins=await importPlugins(r.remarkPlugins);const o=n.highlight?{...n.highlight,highlighter:"function"==typeof n.highlight?.highlighter?n.highlight.highlighter:void 0}:void 0,s=await v(t,{...r,highlight:o,remark:{plugins:r.remarkPlugins},rehype:{options:{handlers:{link:link}},plugins:r.rehypePlugins},toc:r.toc});return{...s.data,excerpt:s.excerpt,body:{...s.body,toc:s.toc},_type:"markdown",_id:e}}});async function importPlugins(e={}){const t={};for(const[n,r]of Object.entries(e))t[n]=!!r&&{instance:r.instance||await import(n).then(e=>e.default||e),options:r};return t}function link(e,t){const n={...t.attributes||{},href:C(normalizeLink(t.url))};null!==t.title&&void 0!==t.title&&(n.title=t.title);const r={type:"element",tagName:"a",properties:n,children:e.all(t)};return e.patch(t,r),e.applyData(t,r)}function normalizeLink(e){const n=e.match(/#.+$/),r=n?n[0]:"";return e.replace(/#.+$/,"").endsWith(".md")&&(t(e)||!/^https?/.test(e)&&!e.startsWith("/"))?d(e.replace(".md"+r,""),{forceLeadingSlash:!1})+r:e}const E=l({name:"Yaml",extensions:[".yml",".yaml"],parse:(e,t)=>{const{data:n}=D(`---\n${t}\n---`);let r=n;return Array.isArray(n)&&(console.warn(`YAML array is not supported in ${e}, moving the array into the \`body\` key`),r={body:n}),{...r,_id:e,_type:"yaml"}}}),R=[q,z,l({name:"Json",extensions:[".json",".json5"],parse:async(e,t)=>{let n;return"string"==typeof t?e.endsWith("json5")?n=(await import("file://C:/Users/sao/Documents/my-site/node_modules/json5/lib/index.js").then(e=>e.default||e)).parse(t):e.endsWith("json")&&(n=P(t)):n=t,Array.isArray(n)&&(console.warn(`JSON array is not supported in ${e}, moving the array into the \`body\` key`),n={body:n}),{...n,_id:e,_type:"json"}}}),E,f];async function transformContent(e,t,n={}){const{transformers:r=[]}=n,o={_id:e,body:t},s=a(e),i=function(e,t=[]){let n=t.find(t=>e.match(new RegExp(t.extensions.join("|"),"i"))&&t.parse);return n||(n=R.find(t=>e.match(new RegExp(t.extensions.join("|"),"i"))&&t.parse)),n}(s,r);if(!i)return console.warn(`${s} files are not supported, "${e}" falling back to raw content`),o;const u=n[c(i.name)]||{},l=await i.parse(o._id,o.body,u),d=function(e,t=[]){return[...t.filter(t=>e.match(new RegExp(t.extensions.join("|"),"i"))&&t.transform),...R.filter(t=>e.match(new RegExp(t.extensions.join("|"),"i"))&&t.transform)]}(s,r);return await d.reduce(async(e,t)=>{const r=await e||l,o=n[c(t.name)];return!1===o?r:t.transform(r,o||{})},Promise.resolve(l))}function createMatch(e={}){const t=function(e,t={}){return{$match:(t,n)=>e(t,n),$eq:(e,t)=>t instanceof RegExp?t.test(e):e===t,$ne:(e,t)=>t instanceof RegExp?!t.test(e):e!==t,$not:(t,n)=>!e(t,n),$and:(t,n)=>(assertArray(n,"$and requires an array as condition"),n.every(n=>e(t,n))),$or:(t,n)=>(assertArray(n,"$or requires an array as condition"),n.some(n=>e(t,n))),$in:(t,n)=>ensureArray(n).some(n=>Array.isArray(t)?e(t,{$contains:n}):e(t,n)),$contains:(e,t)=>(e=Array.isArray(e)?e:String(e),ensureArray(t).every(t=>e.includes(t))),$icontains:(e,t)=>{if("string"!=typeof t)throw new TypeError("$icontains requires a string, use $contains instead");return e=String(e).toLocaleLowerCase(),ensureArray(t).every(t=>e.includes(t.toLocaleLowerCase()))},$containsAny:(e,t)=>(assertArray(t,"$containsAny requires an array as condition"),e=Array.isArray(e)?e:String(e),t.some(t=>e.includes(t))),$exists:(e,t)=>t?void 0!==e:void 0===e,$type:(e,t)=>typeof e===String(t),$regex:(e,t)=>{if(!(t instanceof RegExp)){const e=String(t).match(/\/(.*)\/([dgimsuy]*)$/);t=e?.[1]?new RegExp(e[1],e[2]||""):new RegExp(t)}return t.test(String(e||""))},$lt:(e,t)=>e<t,$lte:(e,t)=>e<=t,$gt:(e,t)=>e>t,$gte:(e,t)=>e>=t,...t||{}}}(match,e.operators);function match(e,n){return"object"!=typeof n||n instanceof RegExp?t.$eq(e,n):Object.keys(n||{}).every(r=>{const o=n[r];if(r.startsWith("$")&&t[r]){const n=t[r];return"function"==typeof n&&n(e,o)}return match(get(e,r),o)})}return match}function createPipelineFetcher(e){const t=createMatch(),r=[(e,n)=>{const r=e.result.filter(e=>ensureArray(n.where).every(n=>t(e,n)));return{...e,result:r,total:r.length}},(e,t)=>ensureArray(t.sort).forEach(t=>((e,t)=>{const n=new Intl.Collator(t.$locale,{numeric:t.$numeric,caseFirst:t.$caseFirst,sensitivity:t.$sensitivity}),r=Object.keys(t).filter(e=>!e.startsWith("$"));for(const o of r)e=e.sort((e,r)=>{const s=[get(e,o),get(r,o)].map(e=>{if(null!==e)return e instanceof Date?e.toISOString():e});return-1===t[o]&&s.reverse(),n.compare(s[0],s[1])});return e})(e.result,t)),function(e,n,r){if(n.surround){let o=((e,{query:n,before:r,after:o})=>{const s="string"==typeof n?{_path:n}:n,i=e.findIndex(e=>t(e,s));r=r??1,o=o??1;const a=new Array(r+o).fill(null,0);return-1===i?a:a.map((t,n)=>e[i-r+n+Number(n>=r)]||null)})(1===e.result?.length?r:e.result,n.surround);o=apply(withoutKeys(n.without))(o),o=apply(withKeys(n.only))(o),e.surround=o}return e}],o=[(e,t)=>{if(t.skip)return{...e,result:e.result.slice(t.skip),skip:t.skip}},(e,t)=>{if(t.limit)return{...e,result:e.result.slice(0,t.limit),limit:t.limit}},function(e,t,r){if(t.dirConfig){const o=e.result[0]?._path||t.where?.find(e=>e._path)?._path;if("string"==typeof o){const t=r.find(e=>e._path===n(o,"_dir"));t&&(e.dirConfig={_path:t._path,...withoutKeys(["_"])(t)})}}return e},(e,t)=>({...e,result:apply(withoutKeys(t.without))(e.result)}),(e,t)=>({...e,result:apply(withKeys(t.only))(e.result)})];return async t=>{const n=await e(),s=t.params(),i={result:n,limit:0,skip:0,total:n.length},a=r.reduce((e,t)=>t(e,s,n)||e,i);if(s.count)return{result:a.result.length};const c=o.reduce((e,t)=>t(e,s,n)||e,a);return s.first?{...(u=["skip","limit","total"],e=>u&&u.length?_pick(e,e=>!u.includes(e)):e)(c),result:c.result[0]}:c;var u}}async function getContentIndex(e){const t=b().content.defaultLocale;let n=await cacheStorage().getItem("content-index.json");if(!n){n=(await H(e)).reduce((e,n)=>(e[n._path]=e[n._path]||[],n._locale===t?e[n._path].unshift(n._id):e[n._path].push(n._id),e),{}),await cacheStorage().setItem("content-index.json",n)}return n}async function getIndexedContentsList(e,t){const n=t.params(),r=n?.where?.find(e=>e._path)?._path;if(!j(e)&&!n.surround&&!n.dirConfig&&("string"==typeof r||r instanceof RegExp)){const t=await getContentIndex(e),n=[...chunksFromArray(Object.keys(t).filter(e=>r.test?r.test(e):e===String(r)).flatMap(e=>t[e]),10)],o=[];for await(const t of n){const n=await Promise.all(t.map(t=>getContent(e,t)));o.push(...n)}return o}return H(e)}const F=Object.freeze(Object.defineProperty({__proto__:null,getContentIndex:getContentIndex,getIndexedContentsList:getIndexedContentsList},Symbol.toStringTag,{value:"Module"})),U=[];let M,Q,T;const sourceStorage=()=>(M||(M=e($(),"content:source")),M),cacheStorage=()=>(Q||(Q=e($(),"cache:content")),Q),cacheParsedStorage=()=>(T||(T=e($(),"cache:content:parsed")),T),contentConfig=()=>b().content,W="'\"?#/".split(""),contentIgnorePredicate=e=>{const t=function(e){const t=["/\\.","/-",...e.filter(e=>e)].map(e=>new RegExp(e));return function(e){const n="/"+e.replace(/:/g,"/");return t.some(e=>e.test(n))}}(contentConfig().ignores);return!e.startsWith("preview:")&&!t(e)&&(!W.some(t=>e.includes(t))||(console.warn(`Ignoring [${e}]. File name should not contain any of the following characters: ${W.join(", ")}`),!1))},getContentsIds=async(e,t)=>{let n=[];const r=sourceStorage();if(0===n.length&&(n=await r.getKeys(t)),j(e)){const{key:o}=S(e),s=`preview:${o}:${t||""}`,i=await r.getKeys(s);if(i.length){const e=new Set(n);await Promise.all(i.map(async t=>{const n=await r.getMeta(t);n?.__deleted?e.delete(t.substring(s.length)):e.add(t.substring(s.length))})),n=Array.from(e)}}return n.filter(contentIgnorePredicate)};function*chunksFromArray(e,t){for(let n=0;n<e.length;n+=t)yield e.slice(n,n+t)}let N=[];const H=(()=>{let e=null;return(t,n)=>t.context.__contentList?t.context.__contentList:N.length?N:(e||(e=(async(e,t)=>{const n=[...chunksFromArray(await getContentsIds(e,t),10)],r=[];for(const t of n){const n=await Promise.all(t.map(t=>getContent(e,t)));r.push(...n)}return r.filter(e=>e&&e._path)})(t,n),e.then(n=>{N=n,t.context.__contentList=n,e=null})),e)})(),J={},getContent=async(e,t)=>{const n=t;if(!contentIgnorePredicate(t))return{_id:n,body:null};const r=sourceStorage(),o=cacheParsedStorage();if(j(e)){const{key:n}=S(e),o=`preview:${n}:${t}`;await r.getItem(o)&&(t=o)}const i=await o.getItem(t),a=contentConfig(),c=await r.getMeta(t),u=c.mtime,l=c.size||0,d=s({mtime:u,size:l,version:a.cacheVersion,integrity:a.cacheIntegrity});return i?.hash===d?i.parsed:(J[t+d]||(J[t+d]=new Promise(async e=>{const s=await r.getItem(t);if(null===s)return e({_id:n,body:null});const i=await parseContent(n,s);await o.setItem(t,{parsed:i,hash:d}).catch(()=>{}),e(i),delete J[t+d]})),J[t+d])},parseContent=async(e,t,n={})=>{const r=A(),o=contentConfig(),s=i(n,{markdown:{...o.markdown,highlight:o.highlight},csv:o.csv,yaml:o.yaml,transformers:U,pathMeta:{defaultLocale:o.defaultLocale,locales:o.locales,respectPathCase:o.respectPathCase}}),a={_id:e,body:"string"==typeof t?t.replace(/\r\n|\r/g,"\n"):t};await r.hooks.callHook("content:file:beforeParse",a);const c=await transformContent(e,a.body,s);return await r.hooks.callHook("content:file:afterParse",c),c},createServerQueryFetch=e=>t=>createPipelineFetcher(()=>getIndexedContentsList(e,t))(t);const K=Object.freeze(Object.defineProperty({__proto__:null,cacheParsedStorage:cacheParsedStorage,cacheStorage:cacheStorage,chunksFromArray:chunksFromArray,createServerQueryFetch:createServerQueryFetch,getContent:getContent,getContentsIds:getContentsIds,getContentsList:H,parseContent:parseContent,serverQueryContent:function(e,t,...s){const{advanceQuery:i}=b().public.content.experimental,a=contentConfig(),c=createQuery(createServerQueryFetch(e),i?{initialParams:"string"!=typeof t&&t||{},legacy:!1}:{initialParams:"string"!=typeof t&&t||{},legacy:!0});let u;"string"==typeof t&&(u=r(n(t,...s)));const l=c.params;return c.params=()=>{const e=l();if(u&&(e.where=e.where||[],e.first&&0===(e.where||[]).length?e.where.push({_path:o(u)}):e.where.push({_path:new RegExp(`^${u.replace(/[-[\]{}()*+.,^$\s/]/g,"\\$&")}`)})),e.sort?.length||(e.sort=[{_stem:1,$numeric:!0}]),e.where=e.where||[],e.where.find(e=>void 0!==e._draft)||e.where.push({_draft:{$ne:!0}}),a.locales.length){const t=e.where?.find(e=>e._locale)?._locale;t||(e.where=e.where||[],e.where.push({_locale:a.defaultLocale}))}return e},c},sourceStorage:sourceStorage},Symbol.toStringTag,{value:"Module"}));export{F as c,K as s};
//# sourceMappingURL=storage.mjs.map
